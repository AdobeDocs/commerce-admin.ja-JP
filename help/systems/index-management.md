---
title: インデックス管理
description: インデックス再作成にトリガーとなるアクションやベストプラクティスなど、インデックス管理について説明します。
exl-id: cbb249a2-b957-44fe-bf81-df795a8fd5d1
feature: System, Configuration
badgePaas: label="PaaS のみ" type="Informative" url="https://experienceleague.adobe.com/ja/docs/commerce/user-guides/product-solutions" tooltip="Adobe Commerce on Cloud プロジェクト（Adobeが管理する PaaS インフラストラクチャ）およびオンプレミスプロジェクトにのみ適用されます。"
source-git-commit: a3737a3fef2e275f110b8858123ea722b4449da3
workflow-type: tm+mt
source-wordcount: '1323'
ht-degree: 0%

---

# インデックス管理

Adobe CommerceとMagento Open Sourceは、1 つ以上の項目が変更されるたびに自動的にインデックスを再作成します。 インデックス再作成をトリガーにするアクションには、価格の変更、カタログまたは買い物かごの価格ルールの作成、新しいカテゴリの追加などがあります。 Commerceでは、パフォーマンスを最適化するために、インデクサーを使用してデータを特別なテーブルに蓄積します。 データが変更されると、インデックス付けされたテーブルを更新するか、インデックスを再作成する必要があります。 Commerceは、バックグラウンドプロセスとしてインデックスを再作成し、プロセス中もストアにアクセスできるようにします。

データのインデックス再作成により、処理が迅速化され、お客様の待ち時間が短縮されます。 例えば、ある商品の価格を 4.99 ドルから 3.99 ドルに変更した場合、Commerceは店舗で価格の変化を示すようにデータのインデックスを再作成します。 インデックスを作成しない場合、Commerceは、買い物かごの価格ルール、バンドル価格、割引、階層別の価格などの処理を行い、その場ですべての商品の価格を計算する必要があります。 製品の価格の読み込みには、お客様が待つ時間よりも長い時間がかかる場合があります。

インデクサーは、保存時またはスケジュールに従って更新するように設定できます。 保存時にのみサポートされる顧客グリッドを除き、すべてのインデックスでいずれかのオプションを使用できます。 保存時にインデックスを作成する場合、Commerceは保存アクションで再インデックスを開始します。 インデックス管理ページが更新を完了し、キャッシュをフラッシュします。再インデックスメッセージは、1 ～ 2 分以内に表示されます。 スケジュールに基づいてインデックスを再作成する場合、インデックス再作成は cron ジョブとしてスケジュールに従って実行されます。 無効になったインデクサーを更新するために [cron ジョブ &#x200B;](cron.md) を使用できない場合は、システムメッセージが表示されます。 インデックス再作成中も、ストアには引き続きアクセスできます。

>[!NOTE]
> Live Search、カタログサービス、Product Recommendations を使用するAdobe Commerce マーチャントは、[SaaS ベースの価格インデクサー &#x200B;](https://experienceleague.adobe.com/ja/docs/commerce/price-indexer/price-indexing) を使用するオプションがあります。

再インデックスが必要な場合は、通知がページの上部に表示されます。 インデックス再作成モードと実行する潜在的なアクションに基づいて、インデックスとメッセージがクリアされます。 インデックス作成について詳しくは、『 [PHP 開発者ガイド &#x200B;](https://developer.adobe.com/commerce/php/development/components/indexing/#how-the-application-implements-indexing) 』の _アプリケーションでインデックスを実装する方法_ を参照してください。

![&#x200B; インデックス管理 – アクション &#x200B;](./assets/index-management.png){width="700" zoomable="yes"}

- インデックス管理では、フラットな製品カタログに対する表示が若干異なります。
- 複数の管理者ユーザーが自動インデックス再作成をトリガーとするオブジェクトを更新する際の問題を回避するために、すべてのインデクサーを [cron ジョブ &#x200B;](cron.md) としてスケジュールに従って実行するように設定することをお勧めします。 そうしないと、オブジェクトが保存されるたびに、相互依存関係を持つオブジェクトがデッドロックを引き起こす可能性があります。 デッドロックの症状には、CPUの使用量が多いこと、MySQL エラーが含まれます。 ベストプラクティスとして、スケジュール済みインデックスを使用することをお勧めします。
- ![Adobe Commerce](../assets/adobe-logo.svg) （Adobe Commerceのみ） デフォルトでは、インデックス再作成などの管理者アクションはシステムにより記録され、[&#x200B; アクションログレポート &#x200B;](action-log-report.md) で確認できます。 アクションログは、ストアの詳細管理設定の [&#x200B; 管理者アクションログ &#x200B;](action-log.md) で設定できます。

## インデックス再作成のベストプラクティス

Commerceでのインデックス再作成とキャッシュの目的は異なります。 インデックスは、データベース情報を追跡して、検索パフォーマンスの向上、ストアフロントでのデータ取得の高速化などを実現します。 [&#x200B; キャッシュ &#x200B;](cache-management.md) 読み込んだデータ、画像、形式などを保存して、ストアフロントへの読み込みとアクセスのパフォーマンスを向上させます。

- 通常は、Commerceでデータを更新する際にインデックスを再作成します。
- 大規模な店舗または複数の店舗がある場合、再インデックスループの可能性があるため、カテゴリや製品などのインデクサーをスケジュールされた cron ジョブに設定する必要がある場合があります。 ピーク時を避ける時間帯に、スケジュールに基づいて再インデックスを設定することができます。
- インデックス再作成時に、フラッシュキャッシュも実行する必要はありません。
- 新規Commerce インストールの場合は、キャッシュをフラッシュして、再インデックス化する必要があります。
- キャッシュとインデックス再作成をフラッシュしても、コンピューターの web ブラウザーキャッシュはフラッシュされません。 ストアフロントの更新が完了したら、ブラウザーのキャッシュをクリアします。

## インデックスモードの変更

>[!IMPORTANT]
>
>[Adobe Commerce B2B](https://experienceleague.adobe.com/docs/commerce-admin/b2b/introduction.html?lang=ja) を使用し、Elasticsearchをフルテキスト （`catalogsearch_fulltext`） インデクサーとして設定しているストアの場合：一括権限の変更後、または「権限」インデクサーが「スケジュール済み」モードの場合は、フルテキスト インデックスを再実行する必要があります。

1. _管理者_ サイドバーで、**[!UICONTROL System]**/_[!UICONTROL Tools]_/**[!UICONTROL Index Management]**&#x200B;に移動します。

1. 変更する各インデクサーのチェックボックスを選択します。

1. **[!UICONTROL Actions]** を次のいずれかに設定します。

   - `Update on Save`
   - `Update by Schedule`
   - `Invalidate index`

     >[!IMPORTANT]
     >
     >[!DNL Customer Grid] のインデクサーの動作は 2.4.8 で変更されました。
     >
     >- **2.4.8 より前**:[!DNL Customer Grid] インデクサーのインデックスは、[!UICONTROL Update on Save] オプションを使用してのみ再作成でき、[!UICONTROL Update by Schedule] オプションはサポートしていません。
     >- **2.4.8 以降**:[!DNL Customer Grid] インデクサーは、[!UICONTROL Update on Save] モードと [!UICONTROL Update by Schedule] モードの両方をサポートしており、デフォルトは [!UICONTROL Update by Schedule] です。

1. 「**[!UICONTROL Submit]**」をクリックして、選択した各インデクサーに変更を適用します。

   **インデックス管理列**

   | 列 | 説明 |
   | ------ |---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | [!UICONTROL Indexer] | インデクサーの名前。 |
   | [!UICONTROL Description] | インデクサーの説明。 |
   | [!UICONTROL Mode] | 各インデクサーの現在の更新モードを示します。 オプション：<br/>**[!UICONTROL Update on Save]**- エンティティの変更が保存されるたびに更新されるようにインデックスが設定されます。 これらのエンティティには、製品、カテゴリ、顧客が含まれます。 保存アクションが完了すると、一連の手順が変更の取得とインデックスの更新を開始します。 インデックス管理ページは、1 ～ 2 分以内にインデックス再作成メッセージを更新してフラッシュします。<br/>**[!UICONTROL Update on Schedule]** - インデックスは、[cron ジョブ &#x200B;](cron.md) に従ってスケジュールに従って更新するように設定されます。 cron ジョブには、インデックス再作成のスケジュール間隔が含まれ、実行時にインデックスに更新が書き込まれます。 |
   | [!UICONTROL Schedule Status] | スケジュール・ステータスの更新を表示します。 |
   | [!UICONTROL Status] | 次のいずれかを表示します。<br/>**[!UICONTROL Ready]**— インデックスが最新です。<br/>**[!UICONTROL Suspended]** - インデックス再作成が一時停止しました。 <br/>**[!UICONTROL Processing]**– 現在、インデックス再作成を実行中です。<br/>**[!UICONTROL Reindex Required]** - インデックス再作成が必要な変更が加えられましたが、インデクサーを自動的に更新できません。 [cron](cron.md) が使用可能で正しく設定されていることを確認します。 |
   | [!UICONTROL Updated] | インデックスが最後に更新された日時を示します。 |

   {style="table-layout:auto"}

## コマンドラインを使用したインデックスの再作成

Commerceでは、コマンドラインを使用して追加の再インデックスオプションを提供しています。 詳細およびコマンド オプションについては、[&#x200B; 構成ガイド &#x200B;](https://experienceleague.adobe.com/docs/commerce-operations/configuration-guide/cli/manage-indexers.html?lang=ja#reindex){:target="blank"} の _再インデックス_ を参照してください。

## インデックストリガーイベント

## インデックス再作成トリガー

| インデックスタイプ | インデックス再作成イベント |
| ---------- | ---------------- |
| [!UICONTROL Product Prices] | 顧客グループの追加 <br/> 構成設定の変更 |
| [!UICONTROL Flat catalog product data] | ストアの追加 <br/> ストアグループの追加 <br/> 属性を追加、編集または削除（検索およびフィルタリング用） |
| [!UICONTROL Flat catalog category data] | ストアの追加 <br/> ストアグループの追加 <br/> 属性を追加、編集または削除（検索およびフィルタリング用） |
| [!UICONTROL Catalog category/product index] | 商品の追加、編集、削除（単一、一括、読み込み） <br/> 商品からカテゴリへの関係の変更 <br/> カテゴリの追加、編集、削除 <br/> ストアの追加または削除 <br/> ストアグループの削除 <br/>web サイトの削除 |
| [!UICONTROL Catalog search index] | 商品の追加、編集、削除（単一、一括、読み込み） <br/> ストアの追加または削除 <br/> ストアグループの削除 <br/>Web サイトの削除 |
| [!UICONTROL Stock status index] | 在庫構成設定の変更 |
| [!UICONTROL Category permissions index] | ストアの追加 <br/> ストアグループの追加 <br/> 属性の追加、削除または更新（検索およびフィルタリング用） |

{style="table-layout:auto"}

>[!IMPORTANT]
>
>フラット カタログを使用することは、現在ではベスト プラクティスとして推奨されていません。 この機能を継続的に使用すると、パフォーマンスの低下やその他のインデックス作成の問題が発生することが知られています。 詳しくは、[&#x200B; フラットカタログ製品の使用 &#x200B;](../catalog/catalog-flat.md) を参照してください。

## インデックスのアクションとコントロール

| アクション | 結果 | コントロール |
| ------ | ------ | -------- |
| ストア、新しい顧客グループ、または `Actions that Cause a Full Reindex` にリストされているアクションの作成 | 完全な再インデックス | 完全なインデックス再作成は、Adobe CommerceまたはMagento Open Source cron ジョブで指定したスケジュールに従って実行されます。 |
| 項目の一括読み込み（Commerceの読み込み/書き出し、ダイレクト SQL クエリおよびデータを直接追加、変更または削除するその他の方法） | 部分再インデックス化（変更された項目のみ再インデックス化されます） | Commerce cron ジョブで決定された頻度。 |
| 範囲の変更（グローバルから web サイトへの変更など） | 部分再インデックス化（変更された項目のみ再インデックス化されます） | Commerce cron ジョブで決定された頻度。 |

{style="table-layout:auto"}

## 完全なインデックス再作成をトリガーにするイベント

| インデクサー | イベント |
| ------- | ----- |
| [!UICONTROL Catalog Category Flat Indexer] | Web ストアの作成 <br/>Web ストアの作成ビュー <br/> 作成、または次のいずれかの属性を削除：<br/> – 詳細検索で検索可能または表示可能 <br/>- フィルタリング可能 <br/> – 検索でフィルタリング可能 <br/> – 並べ替えに使用 <br/> 既存の属性を上記のいずれかに変更<br/> フラット カテゴリのストアフロント オプションを有効にする |
| [!UICONTROL Catalog Product Flat Indexer] | Web ストアの作成 <br>Web ストアの作成ビュー <br/> 作成、または次のいずれかの属性を削除します。<br/> – 詳細検索で検索可能または表示可能 <br>- フィルタリング可能 <br> – 検索でフィルタリング可能 <br/>- ソートに使用 <br/> 既存の属性を上記のいずれかに変更<br/> フラット カテゴリのストアフロント オプションを有効にする |
| [!UICONTROL Stock status indexer] | 次の _カタログ在庫オプション_ が表示されたら、システム設定を変更します。<br/>`Stock Options` – 在庫切れ製品の表示 <br/>`Product Stock Options` – 在庫を管理 |
| [!UICONTROL Price Indexer] | 顧客グループを追加します。<br/> システム構成で次のいずれかのカタログ在庫オプションが変更された場合：<br/>`Stock Options` – 在庫切れ商品の表示 <br/>`Product Stock Options` – 在庫の管理 <br/>`Price` - カタログの価格範囲 |
| [!UICONTROL Category or Product Indexer] | ストアの作成または削除ストアの表示 <br/> 削除 <br/>web サイトの削除 |

{style="table-layout:auto"}
